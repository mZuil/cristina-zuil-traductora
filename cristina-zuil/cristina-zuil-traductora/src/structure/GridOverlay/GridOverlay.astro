---
import './GridOverlay.css';
import CustomContainer from '../CustomContainer/CustomContainer.astro';
import CustomColumn from '../CustomColumn/CustomColumn.astro';
---

<grid-overlay id="grid-overlay" aria-hidden="true">
  <CustomContainer>
    {Array.from({ length: 12 }, (_, i) => i + 1).map((num) => (
      <CustomColumn lg="1" md="1" sm="1" class={`grid-column js-col-${num}`}>
        <div class="grid-column-inner">
          {num}
        </div>
      </CustomColumn>
    ))}
  </CustomContainer>
</grid-overlay>

<script>
  // Toggle grid overlay with Ctrl+Shift+G or Cmd+Shift+G
  document.addEventListener('keydown', (e) => {
    if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'G') {
      e.preventDefault();
      const overlay = document.getElementById('grid-overlay');
      if (overlay) {
        overlay.classList.toggle('active');
      }
    }
  });

  // Hide columns based on current breakpoint
  function updateGridColumns() {
    const width = window.innerWidth;
    let visibleColumns = 4; // default (sm)
    
    if (width >= 1024) {
      visibleColumns = 12; // lg
    } else if (width >= 768) {
      visibleColumns = 8; // md
    }

    // Show/hide columns based on breakpoint
    const allColumns = document.querySelectorAll('.grid-column');
    allColumns.forEach((col, index) => {
      if (index < visibleColumns) {
        (col as HTMLElement).style.display = 'block';
      } else {
        (col as HTMLElement).style.display = 'none';
      }
    });
  }

  // Update on load
  updateGridColumns();

  // Update on resize
  let resizeTimer: number;
  window.addEventListener('resize', () => {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(() => {
      updateGridColumns();
    }, 100);
  });
</script>